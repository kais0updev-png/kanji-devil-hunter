# 新規問題ステージ割当プロンプト
## 漢検7級対応 - kanji-new-questions-only.csv の既存ステージへの反映作業

---

## 📋 作業概要

**目的**: `kanji-new-questions-only.csv` に含まれる新規問題を、既存の10ステージ（Stage1～Stage10）に適切に配分し、漢検7級の642字範囲を完全にカバーする。

**対象ファイル**:
- **入力**: `kanji-new-questions-only.csv` (新規問題)
- **参照**: `kanji-questions-final-clean.csv` (現行333問)
- **出力**: 更新版 `kanji-questions-final-clean.csv` (統合版)

---

## 🎯 要件定義

### 1. データ構造の厳守
すべての問題は以下のCSV形式に従う：
```csv
id,stageId,kanji,grade,questionType,question,choice1,choice2,choice3,choice4,correctAnswer,explanation
```

#### フィールド定義
| フィールド | 型 | 説明 | 制約 |
|-----------|-----|------|------|
| `id` | string | 問題ID | `s{stageId}-q{3桁番号}` 形式。例: `s1-q001`, `s10-q064` |
| `stageId` | number | ステージ番号 | 1～10 |
| `kanji` | string | 対象漢字 | 単一漢字または熟語・概念 |
| `grade` | number | 学年 | 1～4 (小学1～4年生) |
| `questionType` | string | 問題種別 | `reading`, `writing`, `bushu`, `okurigana`, `antonym`, `homophone`, `compound` のいずれか |
| `question` | string | 問題文 | 「〜を選びなさい。」形式推奨 |
| `choice1`～`choice4` | string | 選択肢 | 4択必須 |
| `correctAnswer` | number | 正解 | 0～3 (choice1=0, choice2=1, choice3=2, choice4=3) |
| `explanation` | string | 解説文 | 簡潔な説明 |

---

### 2. 問題種別（questionType）のガイドライン

| 種別 | 英語名 | 説明 | 例 |
|------|--------|------|-----|
| **読み方** | `reading` | 漢字の読み仮名を選択 | 「右手」の「右」の読み方を選びなさい。 |
| **書き取り** | `writing` | 仮名から漢字を選択 | 「くるま」を漢字で書いたものを選びなさい。 |
| **部首** | `bushu` | 漢字の部首名を選択 | 「花」の部首の名前を選びなさい。 |
| **送り仮名** | `okurigana` | 正しい送り仮名を選択 | 「見る」の送り仮名を選びなさい。 |
| **対義語** | `antonym` | 反対の意味の漢字を選択 | 「上」の対義語を選びなさい。 |
| **同音異義語** | `homophone` | 同じ読みの漢字を文脈で選択 | 「した」と読む漢字を選びなさい。「（　）に置く。」 |
| **熟語** | `compound` | 二字熟語の完成 | 「学（　）」に入る漢字を選びなさい。 |

---

### 3. ステージ配分方針

#### 現行ステージ構成（333問）
| Stage | キャラ名 | 現在の問題数 | 学年範囲 | 推奨配分後 |
|-------|----------|-------------|---------|-----------|
| 1 | ポチタ | 32問 | 小1 | 60～65問 |
| 2 | マキマ | 32問 | 小1～2 | 60～65問 |
| 3 | アキ | 35問 | 小2 | 60～65問 |
| 4 | パワー | 38問 | 小2～3 | 60～65問 |
| 5 | 姫野 | 33問 | 小3 | 60～65問 |
| 6 | コベニ | 38問 | 小3 | 60～65問 |
| 7 | レゼ | 33問 | 小3～4 | 60～65問 |
| 8 | ビーム | 35問 | 小4 | 60～65問 |
| 9 | 岸辺 | 28問 | 小4 | 60～65問 |
| 10 | チェンソーマン | 29問 | 小4 (7級) | 60～65問 |

**目標**: 全10ステージで **600～650問** を均等配分（各60～65問）

#### 配分ルール
1. **学年の連続性**: 各ステージは学年範囲に対応
   - Stage 1～2: 小1
   - Stage 3～4: 小2
   - Stage 5～6: 小3
   - Stage 7～10: 小4（漢検7級）

2. **問題タイプの均等配分**: 各ステージで7種類の問題を満遍なく配置
   - 読み方（reading）: 約30%
   - 書き取り（writing）: 約20%
   - 部首（bushu）: 約12%
   - 送り仮名（okurigana）: 約10%
   - 対義語（antonym）: 約9%
   - 同音異義語（homophone）: 約9%
   - 熟語（compound）: 約10%

3. **漢字の重複回避**: 同一ステージ内で同じ漢字を異なる問題タイプで出題するのは推奨するが、全く同一の問題は排除

4. **ID命名規則の厳守**:
   - Stage 1: `s1-q001` ～ `s1-q065`
   - Stage 2: `s2-q001` ～ `s2-q065`
   - ...
   - Stage 10: `s10-q001` ～ `s10-q065`

---

### 4. 新規問題の統合手順

#### ステップ1: 新規問題の分析
1. `kanji-new-questions-only.csv` を開く
2. 各問題の `grade` (学年) を確認
3. 各問題の `questionType` を確認
4. 各問題の `kanji` (対象漢字) を確認

#### ステップ2: ステージへの仮配分
1. **学年別に問題を分類**:
   ```
   grade=1 → Stage1～2候補
   grade=2 → Stage3～4候補
   grade=3 → Stage5～6候補
   grade=4 → Stage7～10候補
   ```

2. **各ステージの現在の問題数を確認**:
   ```bash
   grep "^s1-" kanji-questions-final-clean.csv | wc -l  # Stage1の問題数
   grep "^s2-" kanji-questions-final-clean.csv | wc -l  # Stage2の問題数
   ...
   ```

3. **不足問題数を計算**:
   ```
   目標 60問 - 現在の問題数 = 追加必要数
   ```

#### ステップ3: 問題の追加
1. **IDの採番**:
   - 既存の最大IDを確認: `s1-q032` → 次は `s1-q033`
   - 連番で追加: `s1-q033`, `s1-q034`, ...

2. **問題タイプのバランス**:
   - 既存のタイプ別問題数を確認
   - 不足しているタイプを優先的に追加

3. **重複チェック**:
   - 同一ステージ内で同じ `id` が存在しないか確認
   - 同一ステージ内で完全に同一の `question` + `choices` が存在しないか確認

#### ステップ4: CSV統合
1. 既存 `kanji-questions-final-clean.csv` に新規問題を追加
2. `stageId` でソート、次に `id` でソート
3. ヘッダー行を保持
4. 文字エンケーディング: UTF-8
5. 改行コード: LF (Unix形式)

#### ステップ5: バリデーション
以下を必ずチェック:
```bash
# 1. 総問題数の確認
wc -l kanji-questions-final-clean.csv
# → 601～651行（ヘッダー含む）が目標

# 2. ステージ別問題数の確認
for i in {1..10}; do
  echo "Stage $i: $(grep "^s$i-" kanji-questions-final-clean.csv | wc -l) 問"
done
# → 各ステージ 60～65問 を目標

# 3. ID重複チェック
cut -d',' -f1 kanji-questions-final-clean.csv | sort | uniq -d
# → 何も出力されないこと

# 4. CSV構文エラーチェック
# 各行が11個のカンマ（12フィールド）を持つか確認
```

---

## 🔍 データ品質チェックリスト

### 必須検証項目
- [ ] 全問題が12フィールド（id ～ explanation）を持つ
- [ ] `id` が `s{1-10}-q{001-999}` 形式
- [ ] `stageId` が 1～10 の整数
- [ ] `grade` が 1～4 の整数
- [ ] `questionType` が7種類のいずれか
- [ ] `correctAnswer` が 0～3 の整数
- [ ] `choice1`～`choice4` が全て非空
- [ ] `question` と `explanation` が非空
- [ ] CSV内に重複 `id` が存在しない
- [ ] 各ステージで漢字のカバー範囲が適切

### 推奨検証項目
- [ ] 各ステージで問題タイプが7種類バランス良く配分されている
- [ ] 同一ステージ内で同じ漢字が過度に重複していない（5回以内推奨）
- [ ] 難易度がステージ進行に応じて上昇している
- [ ] 解説文が明確で学習者に分かりやすい
- [ ] 選択肢が適切に誤答を含み、学習効果が高い

---

## 📝 実装例

### 新規問題の追加例（Stage 1）

**既存最大ID**: `s1-q032`

**新規問題1**:
```csv
s1-q033,1,水,1,reading,「水道」の「水」の読み方を選びなさい。,すい,みず,さん,き,0,水は「すい」「みず」と読みます
```

**新規問題2**:
```csv
s1-q034,1,草,1,bushu,「草」の部首の名前を選びなさい。,くさかんむり,そう,きへん,たけかんむり,0,草の部首は「くさかんむり」です
```

**新規問題3**:
```csv
s1-q035,1,おおきい,1,writing,「おおきい」を漢字で書いたものを選びなさい。,大,太,多,犬,0,大が正解です
```

---

## 🚀 作業の進め方

### フェーズ1: データ準備（15分）
1. `kanji-new-questions-only.csv` をダウンロード
2. `kanji-questions-final-clean.csv` をバックアップ
3. 新規問題の総数を確認
4. 学年別・タイプ別の内訳を集計

### フェーズ2: ステージ配分計画（30分）
1. 各ステージの現在の問題数を確認
2. 各ステージの不足問題数を計算
3. 新規問題を学年とタイプで分類
4. 配分計画表を作成（Stage別・タイプ別の追加数）

### フェーズ3: CSV統合（60分）
1. 新規問題にステージIDを付与
2. 新規問題に連番IDを付与
3. 既存CSVに新規問題を追加
4. ソートと整形

### フェーズ4: バリデーション（30分）
1. チェックリストに基づく検証
2. サンプル問題の動作確認
3. 統計情報の出力（ステージ別問題数、タイプ別問題数）
4. 最終版のコミット

---

## 📊 期待される成果物

### 1. 更新版CSV
- **ファイル名**: `kanji-questions-final-clean.csv`
- **総問題数**: 600～650問
- **ステージ別**: 各60～65問

### 2. 統計レポート
```markdown
## 新規問題統合レポート

### 統合前
- 総問題数: 333問
- Stage1: 32問, Stage2: 32問, ..., Stage10: 29問

### 統合後
- 総問題数: 642問
- Stage1: 64問, Stage2: 64問, ..., Stage10: 64問

### 追加内訳
- 新規問題: 309問
- Stage1: +32問, Stage2: +32問, ..., Stage10: +35問

### 問題タイプ別
- reading: 192問 (30%)
- writing: 128問 (20%)
- bushu: 77問 (12%)
- okurigana: 64問 (10%)
- antonym: 58問 (9%)
- homophone: 58問 (9%)
- compound: 65問 (10%)
```

### 3. バリデーションログ
```
✅ ID重複チェック: PASS (重複なし)
✅ フィールド数チェック: PASS (全643行が12フィールド)
✅ correctAnswerチェック: PASS (全て0～3)
✅ ステージ配分チェック: PASS (各60～65問)
⚠️ 警告: Stage5で「山」の問題が6回出現（推奨5回以内）
```

---

## 🛠️ 便利なスクリプト例

### ステージ別問題数の確認
```bash
#!/bin/bash
echo "=== ステージ別問題数 ==="
for i in {1..10}; do
  count=$(grep "^s$i-q" kanji-questions-final-clean.csv | wc -l)
  printf "Stage %2d: %3d 問\n" $i $count
done
```

### 問題タイプ別集計
```bash
#!/bin/bash
echo "=== 問題タイプ別集計 ==="
for type in reading writing bushu okurigana antonym homophone compound; do
  count=$(grep ",$type," kanji-questions-final-clean.csv | wc -l)
  printf "%-12s: %3d 問\n" $type $count
done
```

### 漢字カバー率の確認
```bash
#!/bin/bash
echo "=== 漢字カバー率 ==="
# 重複を除いた漢字数
cut -d',' -f3 kanji-questions-final-clean.csv | tail -n +2 | sort -u | wc -l
echo "問題に含まれる漢字数"
```

---

## ⚠️ 注意事項

1. **既存資産の保護**:
   - 画像パス、キャラ名、ステージ色などは変更しない
   - `STAGES` 配列の構造は維持

2. **データの一貫性**:
   - CSVのエンコーディングは必ずUTF-8
   - カンマ区切りのエスケープに注意（問題文や解説にカンマを含む場合は引用符で囲む）
   - 改行コードはLF

3. **動作確認**:
   - 統合後は必ずブラウザで動作確認
   - 各ステージで問題が正しく読み込まれるか確認
   - 進捗保存と復習機能の動作を確認

4. **バックアップ**:
   - 作業前に必ず既存CSVをバックアップ
   - Git commitでバージョン管理を推奨

---

## 📚 参考リンク

- [漢検公式サイト - 7級](https://www.kanken.or.jp/kanken/outline/degree.html)
- [小学校学習指導要領 - 国語](https://www.mext.go.jp/)
- [プロジェクトREADME](./README.md)
- [Phase 4完了報告](./PHASE4_COMPLETE.md)
- [Phase 5完了報告](./PHASE5_COMPLETE.md)

---

## ✅ 完了確認

作業完了後、以下を確認：
- [ ] 新規CSVが正しく統合された
- [ ] 全ステージで問題が正常に表示される
- [ ] 進捗保存機能が動作する
- [ ] 復習機能が動作する
- [ ] 管理画面で問題一覧が正常に表示される
- [ ] README.mdに最新の統計情報を反映
- [ ] PHASE6_COMPLETE.md を作成して完了報告

---

**作成日**: 2026-02-07  
**対象プロジェクト**: 漢字デビルハンター  
**作成者**: AI Assistant
